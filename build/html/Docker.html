
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="fr">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Docker &#8212; Documentation Abeille 27.04.2019</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <script type="text/javascript" src="_static/translations.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Recherche" href="search.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="docker">
<h1>Docker<a class="headerlink" href="#docker" title="Lien permanent vers ce titre">¶</a></h1>
<div class="section" id="vm-osx">
<h2>VM OSX<a class="headerlink" href="#vm-osx" title="Lien permanent vers ce titre">¶</a></h2>
<p>Une VM sous parallel OSX: debian 9.3.0 / Jeedom 3.1.7 / Abeille 2018-06-19 01:01:07</p>
<p>=== VM</p>
<p>Configuration: choisissez un réseau ponté pour avoir un IP à vous.</p>
<p>=== Debian</p>
<p>Installation de Debian des plus classique (Un gros 1/4 d’heure depuis un ISO sur disque).</p>
<p>Pas d’environnement de bureau, juste un serveur ssh et les utilitaires usuels système.</p>
<p>Une mise a jour en fin d’installation:</p>
<p>deb cdrom:[Debian GNU/Linux 9.3.0 _Stretch_ - Official amd64 DVD Binary-1 20171209-12:11]/ stretch contrib main
apt-get update
apt-get upgrade
—-</p>
<p>=== Jeedom</p>
<p>La documentation Jeedom est à la page <a class="reference external" href="https://Jeedom.github.io/documentation/installation/fr_FR/index">https://Jeedom.github.io/documentation/installation/fr_FR/index</a></p>
<p>Perso j’utilise le dernier chapitre (Chapitre 10 - Autres) (Un gros 1/4 d’heure)</p>
<p>Connectez-vous en SSH à votre système et faites :</p>
<p>chmod +x install.sh
./install.sh
./install.sh -w /var/www/html  -m Jeedom
reboot
—-</p>
<p>=== Web Browser</p>
<p>Ouvrir la page de votre Jeedom: <a class="reference external" href="http://Mon_IP_Jeedom">http://Mon_IP_Jeedom</a></p>
<p>admin/admin</p>
<p>Ne plus afficher et cloture fenetre du dessus.</p>
<p>Creation d’un Objet Abeille pour accueillir tous les futures équipement Zigbee:</p>
<p>Menu-&gt;Outils-&gt;Objets-&gt;”+”, Sauvegarder et retour sur la page principale(Dashboard)</p>
<p>=== Ajout Plugin Abeille</p>
<p>Menu-&gt;Plugins-&gt;Gestion des plugins</p>
<p>Market</p>
<p>Recherche Abeille</p>
<p>Selectionner Abeille</p>
<p>Installer stable (Version 2018-06-19 01:01:07)</p>
<p>Voulez vous aller sur la …. -&gt; Ok</p>
<p>=== Configuration du plugin</p>
<p>Activer</p>
<p>Dependances -&gt; Relancer (ou vous attendez et elles devraient s’installer automatiquement).</p>
<p>Deux messages doivent s’afficher pour confirmer le lancement et le lien vers la doc.</p>
<p>Une fois les dépendances installées, la date de derniere installation doit apparaitre.</p>
<p>Configuration:</p>
<ul class="simple">
<li>Choisissez le port serie (on suppose que vous avez une Zigate ttl sur un port USB déjà branchée, sinon branchez la et rafraichissez la page)</li>
<li>Choisissez l’Objet Parent: Abeille</li>
<li>Sauvegarder</li>
</ul>
<p>Le demon doit démarrer et passer au vert.</p>
<p>Dans mon cas mosquitto fait encore des siennes et il n’a pas démarré. Un reboot du systeme résoud le problème.</p>
<p>Rafraichir la page et vérifier que le demon est passé au vert: Statut Ok et Configuration: Ok.</p>
<p>Et maintenant tout est pret. Retour sur Dashboard. Vous devriez y touver l’équipement Ruche.</p>
<p>=== Demarrage du reseau zigbee</p>
<p>Si vous selectionnez «&nbsp;Version&nbsp;» alors les champs “Last”, “Last Stamps”, “SW”, “SDK” doivent se mettre à jour. Cela confirme que cela fonctionne.</p>
<p>Vous pouvez démarrer le réseau «&nbsp;Start Network&nbsp;».</p>
<p>Et faire un «&nbsp;get Network Status&nbsp;», d’autres champs vont se mettre à jour.</p>
<p>Voilà l’installation d’Abeille dans Jeedom est finie. Vous pouvez intégrer vo équipements.</p>
<p>En tout 1h pour faire une installation from scratch (et écrire cette doc).</p>
<p>== Installation dans un conteneur depuis Ubuntu</p>
<p>=== Introduction</p>
<p>Debian supporte nativement Jeedom et le support est assuré par l’équipe de développement. Toute autre demande à propos d’une distribution est ignorée.   <a class="reference external" href="https://Jeedom.github.io/documentation/installation/fr_FR/index">https://Jeedom.github.io/documentation/installation/fr_FR/index</a></p>
<p>Docker permet d’installer un système invité minimal dans une partie virtualisée du système hôte, tout ajout/suppression/modification du conteneur laisse tel quel le système hôte. L’interet de docker est que n’est installé que le minimum nécéssaire au fonctionnement dans l’image. ( une image éxecutée est un conteneur.) Le but ici est de faire tourner un conteneur Jeedom sur un système Ubuntu, cependant ce n’est pas limité à ce système.</p>
<p>=== Prérequis</p>
<p>Avoir docker disponible dans les dépôts de la distribution.</p>
<p>=== Installation de docker</p>
<p>apt-get install docker docker.io</p>
<p>=== Fonctionnement</p>
<p>Loïc, un des créateurs de Jeedom maintient image Jeedom. Cette image appelé Jeedom-server utilise une image Jeedom-mysql pour stocker les données dans une base de données mysql. Il faudra donc a chaque fois lancer le conteneur Jeedom-mysql puis le Jeedom-server. Les réglages restent d’une fois sur l’autre.</p>
<p>=== Récupération des images et Création des conteneurs</p>
<p>Ces deux lignes vont récupérer les images, créer les conteneurs et les configurer. Le port USB est a adapter selon le besoin ( <cite>ls /dev/ttyUSB*</cite> pour avoir la liste )</p>
<p>docker run –name Jeedom-mysql -e MYSQL_ROOT_PASSWORD=MJeedom96 -d mysql:latest
docker run –name Jeedom-server -e ROOT_PASSWORD=MJeedom96 –link Jeedom-mysql:mysql -p 9180:80 -p 9443:443 -p 9022:22 –device=/dev/ttyUSB0 Jeedom/Jeedom</p>
<p>A ce stade, l’installation de Jeedom commence dans le conteneur Jeedom-server. il faut compter 5 a 10 minutes selon la connexion et la puissance du système hôte.</p>
<p>Jeedom sera disponible après quelques instants à l’adresse <a class="reference external" href="http://0.0.0.0:9180">http://0.0.0.0:9180</a></p>
<p>[TIP]
Le ssh est accessible via le port 9022. (root/MJeedom96)</p>
<p>=== Configuration de Jeedom</p>
<p>Dans les champs indiqués entrer la valeur surlignée.</p>
<p>[width=&nbsp;»40%&nbsp;»,frame=&nbsp;»topbot&nbsp;»,options=&nbsp;»header,footer&nbsp;»]
<a href="#id17"><span class="problematic" id="id18">|==================================
|Database hostname|</span></a> Jeedom-mysql
<a href="#id19"><span class="problematic" id="id20">|Database port    | 3306
|Database username|</span></a> root
<a href="#id21"><span class="problematic" id="id22">|Database password|</span></a> MJeedom96
<a href="#id1"><span class="problematic" id="id2">|</span></a>Database name    | Jeedom
<a href="#id3"><span class="problematic" id="id4">|</span></a>Erase database   | checked
<a href="#id5"><span class="problematic" id="id6">|</span></a>==================================</p>
<p>Une fois, le texte <cite>[END INSTALL SUCCESS]</cite> affiché en bas. Aller à l “adresse <a class="reference external" href="http://0.0.0.0:9180">http://0.0.0.0:9180</a> la page de login de Jeedom devrait apparaître. Les login et mot de passe sont admin admin.</p>
<p>=== start/stop des conteneurs</p>
<p>les conteneurs peuvent être arrêtés et relancés à la demande en gardant l’ordre mysql Jeedom au lancement, Jeedom mysql à  l’arrêt.</p>
<p>Arrêt <cite>docker stop Jeedom-server &amp;&amp; docker stop Jeedom-mysql</cite></p>
<p>Démarrage <cite>docker start Jeedom-mysql &amp;&amp; docker start Jeedom-server</cite></p>
<p>=== Repartir de zéro</p>
<p>il est possible de supprimer les conteneurs et de repartir d’un Jeedom tout neuf.</p>
<p><cite>docker rm Jeedom-server &amp;&amp; docker rm Jeedom-mysql</cite></p>
<p>puis aller vers link:[Récupération des images et Création des conteneurs]</p>
<p>== Portainer</p>
<p>Pour ceux que ne sont pas à l’aise avec la ligne de commande, portainer propose une interface graphique pour gérer les conteneurs et les images.
C’est un conteneur à démarrage automatique qui pourra relancer les conteneurs crées.</p>
<p>docker run -d -p 9000:9000 –name portainer –restart always -v /var/run/docker.sock:/var/run/docker.sock portainer/portainer</p>
<p>le site sera disponible à l’adresse <a class="reference external" href="http://0.0.0.0:9000">http://0.0.0.0:9000</a></p>
<p>== Docker</p>
<p>Installation d’Abeille dans docker
(Il y a certainement plus simple mais je ne suis pas expert en Docker et cette méthode semble bien fonctionner).</p>
<p>=== Preparation du docker</p>
<p>==== Preparation sous Raspbian</p>
<ul class="simple">
<li>installer 2018-06-27-raspbian-stretch-lite.zip sur une SD</li>
<li>demarrer le RPI3</li>
<li>se logger pi/raspberry (atttention au clavier US par defaut)</li>
<li>lancer raspi-config (faire la conf que vous souhaitez): sshd, all memory space, clavier, locales,…</li>
<li>Vérifier la conf réseau</li>
<li>Vous connecter en ssh pour la suite:</li>
</ul>
<div class="section" id="ssh-pi-ip">
<h3>ssh <a class="reference external" href="mailto:pi&#37;&#52;&#48;IP">pi<span>&#64;</span>IP</a><a class="headerlink" href="#ssh-pi-ip" title="Lien permanent vers ce titre">¶</a></h3>
<ul class="simple">
<li>La suite se fait entant que root: sudo su -</li>
</ul>
</div>
<div class="section" id="sudo-su">
<h3>sudo su -<a class="headerlink" href="#sudo-su" title="Lien permanent vers ce titre">¶</a></h3>
<ul class="simple">
<li>une classique mise a jour du systeme:</li>
</ul>
</div>
<div class="section" id="apt-get-update-apt-get-upgrade">
<h3>apt-get update, apt-get upgrade<a class="headerlink" href="#apt-get-update-apt-get-upgrade" title="Lien permanent vers ce titre">¶</a></h3>
<ul class="simple">
<li>Restart du RPI</li>
</ul>
</div>
</div>
<div class="section" id="id7">
<h2>sudo su -<a class="headerlink" href="#id7" title="Lien permanent vers ce titre">¶</a></h2>
<ul class="simple">
<li>Installation de docker:</li>
</ul>
<div class="section" id="verifier-que-cela-fonctionne-un-docker-ps-a-pour-voir-les-images">
<h3>* Vérifier que cela fonctionne, un docker ps -a pour voir les images:<a class="headerlink" href="#verifier-que-cela-fonctionne-un-docker-ps-a-pour-voir-les-images" title="Lien permanent vers ce titre">¶</a></h3>
</div>
</div>
<div class="section" id="docker-ps-a">
<h2>docker ps -a<a class="headerlink" href="#docker-ps-a" title="Lien permanent vers ce titre">¶</a></h2>
<p>On voit ici qu’il n’y a pas d’image, il faut en créer une. Flasher la SD. Demarrer le PI et une commande:</p>
<div class="section" id="docker-ps">
<h3>docker ps<a class="headerlink" href="#docker-ps" title="Lien permanent vers ce titre">¶</a></h3>
<p>Permet de voir que docker fonctionne.</p>
<p>==== Preparation sous hypriot</p>
<p>La version officielle raspbian est un peu vieille et nous n’avons pas toutes les nouveautés. Hypriot a une version bien plus recente et nous facilite la vie (pas de config manuelle tout est prêt). Elle permet aussi de faire tourner le plugin Homebridge (macvlan).
<a class="reference external" href="http://blog.hypriot.com">http://blog.hypriot.com</a></p>
<p>Telecharger leur image à l adresse: <a class="reference external" href="http://blog.hypriot.com/downloads/">http://blog.hypriot.com/downloads/</a></p>
<p>On voit ici qu’il n’y a pas d’image, il faut en créer une.</p>
<p>==== Créons un system pour le docker.</p>
<p><a class="reference external" href="http://www.guoyiang.com/2016/11/04/Build-My-Own-Raspbian-Docker-Image/">http://www.guoyiang.com/2016/11/04/Build-My-Own-Raspbian-Docker-Image/</a></p>
<p>Ici je ne cherche pas à faire une image la plus petite possible mais la plus proche possible d’une install classique sur un HW RPI3. De ce fait l’image fait presque 1G.</p>
</div>
<div class="section" id="recuperer-le-fichier-2018-06-27-raspbian-stretch-lite-zip-par-scp-par-exemple-puis">
<h3>Recuperer le fichier 2018-06-27-raspbian-stretch-lite.zip par scp par exemple. Puis:<a class="headerlink" href="#recuperer-le-fichier-2018-06-27-raspbian-stretch-lite-zip-par-scp-par-exemple-puis" title="Lien permanent vers ce titre">¶</a></h3>
<p>unzip 2018-06-27-raspbian-stretch-lite.zip
losetup -Pr /dev/loop0 2018-06-27-raspbian-stretch-lite.img
mkdir rpi
mount -o ro /dev/loop0p2 ./rpi
tar -C ./rpi -czpf 2018-06-27-raspbian-stretch-lite.tar.gz –numeric-owner .
umount ./rpi
losetup -d /dev/loop0
rmdir rpi
rm 2018-06-27-raspbian-stretch-lite.img
rm 2018-06-27-raspbian-stretch-lite.zip</p>
<p>echo “FROM scratch” &gt; Dockerfile
echo “ADD ./2018-06-27-raspbian-stretch-lite.tar.gz /” &gt;&gt; Dockerfile
echo “CMD [«&nbsp;/bin/bash&nbsp;»]” &gt;&gt; Dockerfile
—-</p>
</div>
</div>
<div class="section" id="maintenant-on-lance-la-creation-du-docker">
<h2>Maintenant on lance la creation du docker:<a class="headerlink" href="#maintenant-on-lance-la-creation-du-docker" title="Lien permanent vers ce titre">¶</a></h2>
</div>
<div class="section" id="docker-build-t-jeedomabeille">
<h2>docker build -t JeedomAbeille .<a class="headerlink" href="#docker-build-t-jeedomabeille" title="Lien permanent vers ce titre">¶</a></h2>
<p>[TIP]
Bien mettre le . a la fin de la ligne.</p>
</div>
<div class="section" id="le-resultat-doit-ressembler-a">
<h2>Le résultat doit ressembler à:<a class="headerlink" href="#le-resultat-doit-ressembler-a" title="Lien permanent vers ce titre">¶</a></h2>
<p><a class="reference external" href="mailto:root&#37;&#52;&#48;docker">root<span>&#64;</span>docker</a>:~/DockerAbeille= docker build -t JeedomAbeille .
Sending build context to Docker daemon 348.4 MB
Step 0 : FROM scratch
—&gt;
Step 1 : ADD ./2018-06-27-raspbian-stretch-lite.tar.gz /
—&gt; f7009768b966
Removing intermediate container ef5668638536
Step 2 : CMD /bin/bash
—&gt; Running in d95d0e65bbb4
—&gt; 286ea5048dfd
Removing intermediate container d95d0e65bbb4
Successfully built 286ea5048dfd
—-</p>
</div>
<div class="section" id="et-si-vous-demandez-les-images">
<h2>Et si vous demandez les images:<a class="headerlink" href="#et-si-vous-demandez-les-images" title="Lien permanent vers ce titre">¶</a></h2>
<p><a class="reference external" href="mailto:root&#37;&#52;&#48;docker">root<span>&#64;</span>docker</a>:~/DockerAbeille= docker images
REPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE
JeedomAbeille       latest              286ea5048dfd        12 minutes ago      900.9 MB
—-</p>
</div>
<div class="section" id="demarrons-le-container">
<h2>Démarrons le container:<a class="headerlink" href="#demarrons-le-container" title="Lien permanent vers ce titre">¶</a></h2>
</div>
<div class="section" id="docker-run-it-jeedomabeille">
<h2>docker run -it JeedomAbeille<a class="headerlink" href="#docker-run-it-jeedomabeille" title="Lien permanent vers ce titre">¶</a></h2>
</div>
<div class="section" id="le-shell-vous-donne-la-main-dans-le-docker">
<h2>Le shell vous donne la main dans le docker:<a class="headerlink" href="#le-shell-vous-donne-la-main-dans-le-docker" title="Lien permanent vers ce titre">¶</a></h2>
</div>
<div class="section" id="root-52b658b7d8f8">
<h2><a class="reference external" href="mailto:root&#37;&#52;&#48;52b658b7d8f8">root<span>&#64;</span>52b658b7d8f8</a>:/=<a class="headerlink" href="#root-52b658b7d8f8" title="Lien permanent vers ce titre">¶</a></h2>
</div>
<div class="section" id="vous-pouvez-arreter-le-docker-depuis-un-shell-sur-le-host">
<h2>Vous pouvez arreter le docker depuis un shell sur le host:<a class="headerlink" href="#vous-pouvez-arreter-le-docker-depuis-un-shell-sur-le-host" title="Lien permanent vers ce titre">¶</a></h2>
<p><a class="reference external" href="mailto:root&#37;&#52;&#48;docker">root<span>&#64;</span>docker</a>:~/DockerAbeille= docker ps
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
52b658b7d8f8        JeedomAbeille       «&nbsp;/bin/bash&nbsp;»         3 minutes ago       Up 3 minutes                            sad_stallman
<a class="reference external" href="mailto:root&#37;&#52;&#48;docker">root<span>&#64;</span>docker</a>:~/DockerAbeille= docker stop 52b658b7d8f8
52b658b7d8f8
—-</p>
<p>Vous pouvez demarrer de docker depuis un shell sur le host:</p>
<p><a class="reference external" href="mailto:root&#37;&#52;&#48;docker">root<span>&#64;</span>docker</a>:~/DockerAbeille= docker ps -a
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                       PORTS               NAMES
52b658b7d8f8        JeedomAbeille       «&nbsp;/bin/bash&nbsp;»         7 minutes ago       Exited (127) 3 minutes ago                       sad_stallman
<a class="reference external" href="mailto:root&#37;&#52;&#48;docker">root<span>&#64;</span>docker</a>:~/DockerAbeille= docker start 52b658b7d8f8
52b658b7d8f8</p>
</div>
<div class="section" id="vous-pouvez-vous-connecter-au-docker">
<h2>Vous pouvez vous connecter au docker:<a class="headerlink" href="#vous-pouvez-vous-connecter-au-docker" title="Lien permanent vers ce titre">¶</a></h2>
<p><a class="reference external" href="mailto:root&#37;&#52;&#48;docker">root<span>&#64;</span>docker</a>:~/DockerAbeille= docker attach 52b658b7d8f8</p>
</div>
<div class="section" id="id8">
<h2><a class="reference external" href="mailto:root&#37;&#52;&#48;52b658b7d8f8">root<span>&#64;</span>52b658b7d8f8</a>:/=<a class="headerlink" href="#id8" title="Lien permanent vers ce titre">¶</a></h2>
<p>[TIP]
Faites plusieurs «&nbsp;enter&nbsp;» pour avoir le prompt.</p>
<p>Maintenant que le docker fonctionne on va faire l installation de Jeedom et Abeille.</p>
<p>[TIP]
To stop a container, use CTRL-c. This key sequence sends SIGKILL to the container. If –sig-proxy is true (the default),CTRL-c sends a SIGINT to the container. You can detach from a container and leave it running using the [underline]#CTRL-p suivi de CTRL-q# key sequence.</p>
<p>==== Service dans le docker</p>
<p>Les services ne demarrent pas tout seuls dans le docker, il aurait probablement du le faire dans Dockfile.</p>
<p>Donc j’ajoute quelques lignes à /etc/rc.local pour Raspbian:</p>
<p>docker exec -u root JeedomAbeille /etc/init.d/ssh start
docker exec -u root JeedomAbeille /etc/init.d/mysql start
docker exec -u root JeedomAbeille /etc/init.d/apache2 start
docker exec -u root JeedomAbeille /etc/init.d/cron start
—-</p>
<p>que je mets sur le host dans /root sous le nom startJeedomAbeileDocker.sh.
et un bon vieux:  chmod u+x startJeedomAbeileDocker.sh</p>
<p>et pour hypriot qui n’a pas de rc.local, je fait un script:</p>
</div>
<div class="section" id="vi-startdockers">
<h2>vi startDockers<a class="headerlink" href="#vi-startdockers" title="Lien permanent vers ce titre">¶</a></h2>
<p>Je mets dedans</p>
<p>=== BEGIN INIT INFO
== Provides:          startDockers
== Required-Start:    $remote_fs $syslog
== Required-Stop:     $remote_fs $syslog
== Default-Start:     2 3 4 5
== Default-Stop:      0 1 6
== Short-Description: Simple script to start a program at boot
== Description:       A simple script from www.stuffaboutcode.com which will start / stop a program a boot / shutdown.
=== END INIT INFO</p>
<p>== If you want a command to always run, put it here</p>
<p>== Carry out specific functions when asked to by the system
case «&nbsp;$1&nbsp;» in
start)
echo «&nbsp;Starting startDockers&nbsp;»
== run application you want to start
docker start Jeedomgite
docker exec -u root Jeedomgite /etc/init.d/ssh start
docker exec -u root Jeedomgite /etc/init.d/mysql start
docker exec -u root Jeedomgite /etc/init.d/apache2 start
docker exec -u root Jeedomgite /etc/init.d/cron start
;;
stop)
echo «&nbsp;Stopping startDockers&nbsp;»
= kill application you want to stop
docker stop Jeedomgite
;;
<a href="#id9"><span class="problematic" id="id10">*</span></a>)
echo «&nbsp;Usage: /etc/init.d/startDockers {start|stop}&nbsp;»
exit 1
;;
esac</p>
</div>
<div class="section" id="exit-0">
<h2>exit 0<a class="headerlink" href="#exit-0" title="Lien permanent vers ce titre">¶</a></h2>
<p>Je sauvegarde.</p>
</div>
<div class="section" id="update-rc-d-startdockers-defaults">
<h2>update-rc.d startDockers defaults<a class="headerlink" href="#update-rc-d-startdockers-defaults" title="Lien permanent vers ce titre">¶</a></h2>
</div>
<div class="section" id="ajouter-la-ligne">
<h2>Ajouter la ligne<a class="headerlink" href="#ajouter-la-ligne" title="Lien permanent vers ce titre">¶</a></h2>
<ul class="simple">
<li><ul class="first">
<li><ul class="first">
<li><ul class="first">
<li><ul class="first">
<li>su –shell=/bin/bash - www-data -c “/usr/bin/php /var/www/html/core/php/jeeCron.php” &gt;&gt; /dev/null</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Thanks to <a class="reference external" href="https://www.stuffaboutcode.com/2012/06/raspberry-pi-run-program-at-start-up.html">https://www.stuffaboutcode.com/2012/06/raspberry-pi-run-program-at-start-up.html</a></p>
<p>==== Installation Jeedom</p>
<p>Dans le container precedent nous n’avons pas pris en compte les besoins réseaux et port série.
Effaçons l’ancien container.
—-
docker rm 52b658b7d8f8
—-</p>
<p>Créons en un nouveau avec les ports mysql, apache, ssh et le port serie ttyUSB0 (la Zigate).</p>
</div>
<hr class="docutils" />
<div class="section" id="si-vous-etes-sur-hyprio-et-voulez-exposer-la-machine-completement-cree-le-networks-puis-le-containers">
<h2>Si vous êtes sur hyprio et voulez exposer la machine completement, créé le Networks puis le Containers:<a class="headerlink" href="#si-vous-etes-sur-hyprio-et-voulez-exposer-la-machine-completement-cree-le-networks-puis-le-containers" title="Lien permanent vers ce titre">¶</a></h2>
<p>docker network create -d macvlan –subnet=192.168.4.0/24 –gateway=192.168.4.2 -o parent=eth0 pub_net
docker run –name=Jeedomgite –device=/dev/ttyACM0 –network pub_net –ip=192.168.4.38 –hostname=Jeedomgite -it Jeedomgite /bin/bash
—-</p>
<p>Attention de ne pas vous prendre les pieds dans le tapis entre les adresses du «&nbsp;HW&nbsp;» rpi et les addresses des containers.</p>
<p>Donc Jeedom sera accessible sur le port 80 à l’adresse IP du host. 2222 pour ssh et 3306 pour mysql.
J’ai mis un nom pour être plus sympas à gérer.</p>
</div>
<div class="section" id="vous-pourrez-le-demarrer-arreter-par">
<h2>Vous pourrez le demarrer/arreter par:<a class="headerlink" href="#vous-pourrez-le-demarrer-arreter-par" title="Lien permanent vers ce titre">¶</a></h2>
<p>docker stop JeedomAbeille
docker start JeedomAbeille
—-</p>
</div>
<div class="section" id="passons-a-l-installation-des-services">
<h2>Passons a l installation des services:<a class="headerlink" href="#passons-a-l-installation-des-services" title="Lien permanent vers ce titre">¶</a></h2>
<p>docker attach JeedomAbeille
apt-get update
apt-get upgrade
apt-get install openssh-server
dpkg-reconfigure openssh-server
/etc/init.d/ssh start
apt-get install mariadb-server
apt-get install apache2
—-</p>
<p>Maintenant le systeme doit être prêt pour l installation de Jeedom lui-meme.
(<a class="reference external" href="https://Jeedom.github.io/documentation/installation/fr_FR/index">https://Jeedom.github.io/documentation/installation/fr_FR/index</a> =&gt; Chap 10)</p>
</div>
<div class="section" id="install-sh-w-var-www-html-m-jeedom">
<h2>./install.sh -w /var/www/html -m Jeedom<a class="headerlink" href="#install-sh-w-var-www-html-m-jeedom" title="Lien permanent vers ce titre">¶</a></h2>
<p>L installation va se dérouler en 11 grandes étapes.</p>
</div>
<div class="section" id="installation-finie-un-redemarrage-devrait-etre-effectue">
<h2>Installation finie. Un redémarrage devrait être effectué<a class="headerlink" href="#installation-finie-un-redemarrage-devrait-etre-effectue" title="Lien permanent vers ce titre">¶</a></h2>
<p>avec un ps -ef, vous devriez voir apache, ssh et mysql fonctionner.</p>
<p>Puis vous vous connecter à Jeedom avec l adresse <a class="reference external" href="http://IP_Host:80/">http://IP_Host:80/</a>
Connectez vous avec admin/admin.
Sauf que cela ne fonctionne pas !! -&gt;Mot de passe ou nom d’utilisateur incorrect&lt;-</p>
<p>Il demande un reboot donc allons y:</p>
<p>docker attach JeedomAbeille
/etc/init.d/ssh start
/etc/init.d/mysql start
/etc/init.d/apache2 start
—-</p>
<p>On ne peut toujours pas se connecter, je ne sais pas pourquoi….</p>
<p>Donc on va passer par une autre solution: <a class="reference external" href="https://Jeedom.github.io/documentation/howto/fr_FR/reset.password">https://Jeedom.github.io/documentation/howto/fr_FR/reset.password</a></p>
<p>Problement de «&nbsp;Could not reliably determine the server’s fully qualified domain name, using 172.17.0.14. Set the “ServerName” directive globally to suppress this message&nbsp;»:
mettre en debut de fichier /etc/apache2/apache2.conf la line :
—-
Global configuration</p>
</div>
<div class="section" id="servername-2b8faafb19a4">
<h2>ServerName 2b8faafb19a4<a class="headerlink" href="#servername-2b8faafb19a4" title="Lien permanent vers ce titre">¶</a></h2>
<p><a class="reference external" href="mailto:root&#37;&#52;&#48;2b8faafb19a4">root<span>&#64;</span>2b8faafb19a4</a>:/etc/apache2= apachectl configtest
Syntax OK</p>
</div>
<div class="section" id="id11">
<h2>ServerName 2b8faafb19a4<a class="headerlink" href="#id11" title="Lien permanent vers ce titre">¶</a></h2>
</div>
<div class="section" id="puis-tester">
<h2>Puis tester:<a class="headerlink" href="#puis-tester" title="Lien permanent vers ce titre">¶</a></h2>
<p><a class="reference external" href="mailto:root&#37;&#52;&#48;2b8faafb19a4">root<span>&#64;</span>2b8faafb19a4</a>:/etc/apache2= apachectl configtest
Syntax OK
—-</p>
<p>::1    localhost ip6-localhost ip6-loopback
fe00::0    ip6-localnet
ff00::0    ip6-mcastprefix
ff02::1    ip6-allnodes
ff02::2    ip6-allrouters
172.17.0.14    2b8faafb19a4    JeedomAbeille
172.17.0.14    JeedomAbeille.bridge
—-</p>
<p>use Jeedom;
REPLACE INTO user SET <a href="#id12"><span class="problematic" id="id13">`</span></a>login`=”adminTmp”,password=”c7ad44cbad762a5da0a452f9e854fdc1e0e7a52a38015f23f3eab1d80b931dd472634dfac71cd34ebc35d16ab7fb8a90c81f975113d6c7538dc69dd8de9077ec”,profils=”admin”, enable=“1”;
exit
—-</p>
<p>Et maintenant on peut se connecter en adminTmp/admin.</p>
<p>Aller dans la conf reseau et mettre l adresse du host dans les adresses http.</p>
<p>Maintenant on peut se connecter en admin/admin donc on peut effacer l utilisateur adminTmp.</p>
<p>==== Installation du plugin Abeille</p>
<ul class="simple">
<li>Créer un objet Abeille.</li>
<li>Installer le plugin Abeille depuis le market.</li>
<li>L’activer.</li>
<li>Lancer l installation des dépendances.</li>
<li>Definissez les bons parametres du demon.</li>
<li>Lancer le demon</li>
<li>L objet Ruche doit être créé.</li>
<li>un petit getVersion et vous devriez avoir le champ SW et SDK qui se mettent à jour.</li>
</ul>
<p>Enjoy !!!</p>
<p>Vous allez certainement avoir le message:
«&nbsp;Jeedom est en cours de démarrage, veuillez patienter. La page se rechargera automatiquement une fois le démarrage terminé.&nbsp;»</p>
<p>==== Backup du Docker</p>
<p>Plusieures solutions s’offrent à nous. Il est interessant de comprende ce qui se passe. Un bon article à lire: <a class="reference external" href="https://tuhrig.de/difference-between-save-and-export-in-docker/">https://tuhrig.de/difference-between-save-and-export-in-docker/</a></p>
<p>Toutes les operations suivantes se font depuis le host.</p>
<p>===== Commit / Save / Load</p>
<p>Permet de garder tout l’historique.</p>
<p>===== Commit</p>
</div>
<div class="section" id="pour-avoir-les-docker-en-fonctionnement">
<h2>Pour avoir les docker en fonctionnement :<a class="headerlink" href="#pour-avoir-les-docker-en-fonctionnement" title="Lien permanent vers ce titre">¶</a></h2>
</div>
<div class="section" id="id14">
<h2>docker ps<a class="headerlink" href="#id14" title="Lien permanent vers ce titre">¶</a></h2>
</div>
<div class="section" id="pour-avoir-les-docker-en-stock">
<h2>Pour avoir les docker en stock:<a class="headerlink" href="#pour-avoir-les-docker-en-stock" title="Lien permanent vers ce titre">¶</a></h2>
</div>
<div class="section" id="id15">
<h2>docker ps -a<a class="headerlink" href="#id15" title="Lien permanent vers ce titre">¶</a></h2>
<p>Créons un image du docker en prod: JeedomAbeille et appelons cette image JeedomAbeille_backup</p>
<div class="section" id="docker-commit-p-jeedomabeille-jeedomabeille-backup">
<h3>docker commit -p JeedomAbeille JeedomAbeille_backup<a class="headerlink" href="#docker-commit-p-jeedomabeille-jeedomabeille-backup" title="Lien permanent vers ce titre">¶</a></h3>
<p>Attention: avec le -p le container est en pause donc Jeedom ne fonctionne plus le temps de faire la capture.</p>
<p>Par exemple: faites cette operation avant de faire des opérations irréversibles qui risquent de planter votre Jeedom.</p>
</div>
</div>
<div class="section" id="pour-voir-les-images-crees-et-disponiqbles">
<h2>Pour voir les images crées et disponiqbles:<a class="headerlink" href="#pour-voir-les-images-crees-et-disponiqbles" title="Lien permanent vers ce titre">¶</a></h2>
</div>
<div class="section" id="docker-images">
<h2>docker images<a class="headerlink" href="#docker-images" title="Lien permanent vers ce titre">¶</a></h2>
</div>
<div class="section" id="save">
<h2>===== Save<a class="headerlink" href="#save" title="Lien permanent vers ce titre">¶</a></h2>
<p>docker save -o ~/JeedomAbeille_backup.tar JeedomAbeille_backup
ls -l ~/JeedomAbeille_backup.tar
—-</p>
<p>soyez patient le tar fait 3G.</p>
<p>===== Load</p>
<p>If we have transferred our «&nbsp;container1.tar&nbsp;» backup file to another docker host system we first need to load backed up tar file into a docker’s local image repository:</p>
<hr class="docutils" />
<p>===== Export / Import</p>
<p>Garde que la derniere version.</p>
<p>===== Export</p>
<hr class="docutils" />
<p>===== Import</p>
<div class="section" id="cat-home-export-tar-sudo-docker-import-nameyouwant-latest">
<h3>cat /home/export.tar | sudo docker import - NameYouWant:latest<a class="headerlink" href="#cat-home-export-tar-sudo-docker-import-nameyouwant-latest" title="Lien permanent vers ce titre">¶</a></h3>
<p>==== Conclusion</p>
<p>Plus besoin d’aller chercher les cartes SD dans les differents RPI3 pour en faire de images. Tout va se faire à distance maintenant !!! YaaahhhOOOOUUU !!!!!</p>
</div>
</div>
<div class="section" id="vous-pouvez-effacer-de-vieilles-images-par">
<h2>Vous pouvez effacer de vieilles images par:<a class="headerlink" href="#vous-pouvez-effacer-de-vieilles-images-par" title="Lien permanent vers ce titre">¶</a></h2>
</div>
<div class="section" id="docker-rmi-jeedomabeille-backup">
<h2>docker rmi JeedomAbeille_backup<a class="headerlink" href="#docker-rmi-jeedomabeille-backup" title="Lien permanent vers ce titre">¶</a></h2>
<p>===== Docker GUI</p>
<p>====== Sur la raspbian</p>
<p>Thanks to:
* <a class="reference external" href="http://blog.hypriot.com/post/new-docker-ui-portainer/">http://blog.hypriot.com/post/new-docker-ui-portainer/</a>
* <a class="reference external" href="https://portainer.readthedocs.io/en/latest/deployment.html">https://portainer.readthedocs.io/en/latest/deployment.html</a></p>
</div>
<div class="section" id="il-semble-qu-on-puisse-utiliser-une-interface-graphique-portainer-io-sur-le-rpi-saisir">
<h2>Il semble qu’on puisse utiliser une interface graphique «&nbsp;portainer.io&nbsp;» sur le rpi, saisir:<a class="headerlink" href="#il-semble-qu-on-puisse-utiliser-une-interface-graphique-portainer-io-sur-le-rpi-saisir" title="Lien permanent vers ce titre">¶</a></h2>
</div>
<div class="section" id="docker-run-d-p-9000-9000-name-portainer-restart-always-v-var-run-docker-sock-var-run-docker-sock-portainer-portainer-arm-h-unix-var-run-docker-sock">
<h2>docker run -d -p 9000:9000 –name portainer –restart always -v /var/run/docker.sock:/var/run/docker.sock portainer/portainer:arm -H unix:///var/run/docker.sock<a class="headerlink" href="#docker-run-d-p-9000-9000-name-portainer-restart-always-v-var-run-docker-sock-var-run-docker-sock-portainer-portainer-arm-h-unix-var-run-docker-sock" title="Lien permanent vers ce titre">¶</a></h2>
<p>Puis se logger sur <a class="reference external" href="http://IP_Host:9000">http://IP_Host:9000</a>
Tout ne fonctionne pas mais c’est plus sympas que la ligne de commande.</p>
<p>Il semble que la version rpi par defaut est un peu ancienne et certaine feature comme volume ne sont pas dispo.</p>
<p>====== Sur la hypriot</p>
<p><a class="reference external" href="https://hub.docker.com/r/hypriot/rpi-portainer/">https://hub.docker.com/r/hypriot/rpi-portainer/</a></p>
<div class="section" id="docker-run-d-p-9000-9000-v-var-run-docker-sock-var-run-docker-sock-hypriot-rpi-portainer">
<h3>docker run -d -p 9000:9000 -v /var/run/docker.sock:/var/run/docker.sock hypriot/rpi-portainer<a class="headerlink" href="#docker-run-d-p-9000-9000-v-var-run-docker-sock-var-run-docker-sock-hypriot-rpi-portainer" title="Lien permanent vers ce titre">¶</a></h3>
<p>Puis se logger sur <a class="reference external" href="http://IP_Host:9000">http://IP_Host:9000</a>.
Tout fonctionne bien mieux que sur la version raspbian.</p>
<p>==== Plugins</p>
<p>===== Zwave</p>
<p>Sur ma machine Jeedomprorpi, le repertoire /tmp/Jeedom/openzwave n’a pas les bons droits et le demon est toujours en erreur. Je viens de faire un chmod 777 /tmp/Jeedom/openzwave et tout est ok maintenant.</p>
<p>===== homebridge</p>
<p>Comme il faut que le docker soit exposé au sous réseau, il faut utiliser macvlan et affecter une adresse spécifique.</p>
<p>[[Ubuntu]]
== Installation sur une VM Ubuntu</p>
<p>=== Installation de l’OS</p>
<p>Fichier ISO: ubuntu-16.04.1-server-amd64.iso</p>
<p>Installation classique de l’OS (Je ne détaille pas car cela dépend de votre envirroement de virtualisation).</p>
<p>=== Preparation de l’OS</p>
<p>login: (user créé pendant l install avec son password associé).</p>
<p>apt-get update
apt-get upgrade
apt-get autoremove
—-</p>
<p>=== Installation de la base mysql</p>
<p>installation à la main de mysql (car l instanllation par Jeedom ne fonctionne pas)</p>
<hr class="docutils" />
<p>=== Installation de Jeedom</p>
<hr class="docutils" />
<p>Enlever le php7.0-ssh2 du fichier install.sh</p>
</div>
<div class="section" id="install-sh-m-motdepasse">
<h3>./install.sh -m motDePasse<a class="headerlink" href="#install-sh-m-motdepasse" title="Lien permanent vers ce titre">¶</a></h3>
<p>A cette étape vous devoir pourvoir ouvrir un browser et utiliser Jeedom.</p>
<p>=== Installation du Plugin Abeille</p>
<p>cd /var/www/html/plugins/</p>
<p>git clone <a class="reference external" href="https://github.com/KiwiHC16/Abeille.git">https://github.com/KiwiHC16/Abeille.git</a> Abeille</p>
<p>chmod -R 777 /var/www/html/plugins/Abeille
chown -R www-data:www-data /var/www/html/plugins/Abeille
—-</p>
<p>=== Utilisation de Jeedom</p>
<p>Il ne vous reste plus qu’à vous connecter à Jeedom…</p>
<p>[[XU4]]
== Installation sur une machine Odroid XU4 avec Ubuntu</p>
<p>=== Installation de l’OS</p>
<p>Fichier img: ubuntu-14.04lts-server-odroid-xu3-20150725.img
que l on trouve sur le server odroid: <a class="reference external" href="https://odroid.in/ubuntu_14.04lts/">https://odroid.in/ubuntu_14.04lts/</a></p>
<p>Installation classique odroid de l’OS : <a class="reference external" href="https://wiki.odroid.com/odroid-xu4/odroid-xu4">https://wiki.odroid.com/odroid-xu4/odroid-xu4</a></p>
<p>=== Preparation de l’OS</p>
<p>login: (root/odroid).</p>
</div>
</div>
<div class="section" id="apt-get-autoremove">
<h2>apt-get autoremove<a class="headerlink" href="#apt-get-autoremove" title="Lien permanent vers ce titre">¶</a></h2>
<p>=== Installation de la base mysql</p>
<p>installation à la main de mysql (car l instanllation par Jeedom ne fonctionne pas)</p>
<hr class="docutils" />
<p>=== Installation de Jeedom</p>
<hr class="docutils" />
<p>Enlever le php7.0-ssh2 du fichier install.sh</p>
<div class="section" id="id16">
<h3>./install.sh -m motDePasse<a class="headerlink" href="#id16" title="Lien permanent vers ce titre">¶</a></h3>
<p>A cette étape vous devoir pourvoir ouvrir un browser et utiliser Jeedom.</p>
<p>=== Installation du Plugin Abeille</p>
<p>cd /var/www/html/plugins/</p>
<p>git clone <a class="reference external" href="https://github.com/KiwiHC16/Abeille.git">https://github.com/KiwiHC16/Abeille.git</a> Abeille</p>
<p>chmod -R 777 /var/www/html/plugins/Abeille
chown -R www-data:www-data /var/www/html/plugins/Abeille
—-</p>
<p>=== Utilisation de Jeedom</p>
<p>Il ne vous reste plus qu’à vous connecter à Jeedom…</p>
<p>== De-installation</p>
<p>Le plugin Abeille utilise:
- le code du plugin lui-même et
- un broker MQTT mosquitto.</p>
<p>Par défaut, lors de l’installation de Abeille, le code du plugin est installé depuis le market et le broker est installé lors de l installation des dépendances.</p>
<p>Le broker MQTT peux être utilisé par d’autres logiciels comme par d’autres plugins.</p>
<p>C’est pourquoi lors de la desinstallation d’Abeille, mosquitto n’est pas desintallé, ni sa configuration.</p>
<p>Si vous souhaitez le desinstaller, vous avez le script «&nbsp;manual_remove_of_mosquito.sh&nbsp;» qui peut vous aider à enlever les déclaraitons faites dans apaches.</p>
<p>Pour la désinstallation de mosquitto, cela depend de votre système et il y a plein de doc sur le net (je manque de temps pour faire la doc…).</p>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">Abeille</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Presentation.html">Presentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="Eurotronics.html">Eurotronics</a></li>
<li class="toctree-l1"><a class="reference internal" href="Ikea.html">Ikea</a></li>
<li class="toctree-l1"><a class="reference internal" href="Tuto.html">Tuto</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog.html">ChangeLog</a></li>
<li class="toctree-l1"><a class="reference internal" href="Help.html">Help</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Recherche rapide</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, KiwiHC16.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/Docker.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>